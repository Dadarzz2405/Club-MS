{% extends "base.html" %}

{% block title %}PIC Management — Rohis{% endblock %}

{% block content %}
<div class="mt-4">
    <h2>Assign Attendance Permission</h2>

    <form method="POST">
        <div class="mb-3">
            <label for="pic_id" class="form-label">Select PIC</label>
            <select id="pic_id" name="pic_id" class="form-select" required>
                {% for p in pics %}
                    <option value="{{ p.id }}">{{ p.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="user_ids" class="form-label">Select Members (hold Ctrl / Cmd to select multiple)</label>
            <select id="user_ids" name="user_ids" class="form-select" multiple size="8" required>
                {% for user in users %}
                    <option value="{{ user.id }}">{{ user.name }} — {{ user.pic.name if user.pic else 'No PIC' }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="marker_id" class="form-label">Choose one member to be able to mark attendance (optional)</label>
            <select id="marker_id" name="marker_id" class="form-select">
                <option value="">-- No marker --</option>
                {% for user in users %}
                    <option value="{{ user.id }}">{{ user.name }}</option>
                {% endfor %}
            </select>
        </div>

        <button class="btn btn-primary" type="submit">Save</button>
    </form>

    <hr>

    <h4>Current Permissions</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Role</th>
                <th>PIC</th>
                <th>Permission</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>{{ u.name }}</td>
                <td>{{ u.role }}</td>
                <td>{{ u.pic.name if u.pic else '-' }}</td>
                <td>{{ '✅' if u.can_mark_attendance else '❌' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
